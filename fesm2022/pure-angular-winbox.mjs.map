{"version":3,"file":"pure-angular-winbox.mjs","sources":["../../../../packages/angular-winbox/src/lib/winbox.service.ts","../../../../packages/angular-winbox/src/pure-angular-winbox.ts"],"sourcesContent":["import {\n  ApplicationRef,\n  ChangeDetectorRef,\n  ComponentRef,\n  createComponent,\n  Injectable,\n  Type,\n} from '@angular/core';\nimport 'winbox';\n\ndeclare const WinBox: WinBox.WinBoxConstructor;\n\nexport type WinBoxOptions = WinBox.Params;\n\nexport interface WinBoxContainer<ComponentInstance> {\n  winBox: WinBox;\n  instance: ComponentInstance;\n  changeDetectorRef?: ChangeDetectorRef;\n}\n\n@Injectable({ providedIn: 'root' })\nexport class WinboxService {\n  private winBoxStack: WinBox[] = [];\n  public isThereAWinBox = false;\n\n  constructor(private appRef: ApplicationRef) {}\n  get numberOfWinBoxes(): number {\n    return this.winBoxStack.length;\n  }\n\n  openWinBox<ComponentInstance>(\n    options: WinBoxOptions,\n    component: Type<ComponentInstance>\n  ): WinBoxContainer<ComponentInstance> {\n    const winBox = new WinBox(options);\n\n    const componentRef = createComponent(component, {\n      environmentInjector: this.appRef.injector,\n      hostElement: winBox.body,\n    });\n    this.appRef.attachView(componentRef.hostView);\n\n    // estensione del metodo per permettere all'utente di passare\n    // una funzione da invocare alla chiusura della winBox\n    const optionsClose = options.onclose;\n    winBox.onclose = (force) => {\n      if (force) {\n        return this.destroyComponent<ComponentInstance>(componentRef, winBox);\n      }\n      const isCloseConfirmed = optionsClose?.apply(winBox, [force]);\n      if (isCloseConfirmed || !optionsClose) {\n        return this.destroyComponent<ComponentInstance>(componentRef, winBox);\n      }\n      return true;\n    };\n    this.isThereAWinBox = true;\n    this.winBoxStack.push(winBox);\n    winBox.hide();\n    return {\n      winBox,\n      instance: componentRef.instance,\n      changeDetectorRef: componentRef.injector.get(ChangeDetectorRef),\n    };\n  }\n\n  public closeAllWinBoxes() {\n    for (const winBox of this.winBoxStack) {\n      winBox.close(true);\n    }\n    this.winBoxStack = [];\n    this.isThereAWinBox = false;\n  }\n\n  /** This method show the last Winbox created*/\n  public showLastWinbox() {\n    if (this.winBoxStack.length > 0)\n      this.winBoxStack[this.winBoxStack.length - 1].show();\n  }\n\n  /** This method minimize a Winbox selected by id*/\n  public minimizeWinbox(id: string | number, state: boolean) {\n    this.winBoxStack.find((winbox) => winbox.id === id)?.minimize(state);\n  }\n\n  /** This method maximize a Winbox selected by id*/\n  public maximizeWinbox(id: string | number, state: boolean) {\n    this.winBoxStack.find((winbox) => winbox.id === id)?.maximize(state);\n  }\n\n  private destroyComponent<ComponentInstance>(\n    componentRef: ComponentRef<ComponentInstance>,\n    winBox: WinBox\n  ): boolean {\n    componentRef.destroy();\n    this.winBoxStack = this.winBoxStack.filter((w) => w.id !== winBox.id);\n    this.isThereAWinBox = this.winBoxStack.length !== 0;\n    return false;\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}
